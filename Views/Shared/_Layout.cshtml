<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>@ViewBag.Title - Master Exchance</title>
    <link href="~/Content/sidebar.css" rel="stylesheet" />
    <!-- sweet alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>


    <!-- bootstrap 4 -->

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

    <!-- Ionic icons -->
    <script src="https://kit.fontawesome.com/30fa52b14d.js" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.js"></script>
    <script src="~/Scripts/secion.js"></script>

    <!-- Print.js-->
    <script src="  https://printjs-4de6.kxcdn.com/print.min.js"></script>
    <link href="~/Content/Usuarios.css" rel="stylesheet" />
    <script src="~/Scripts/push.min.js"></script>
    <!-- libreria de notificaciones -->
    

    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
</head>
<body class="" >
    <div style="display: none">
        <input id="uservalue" value="@Session["intareadeusurio"]" />
           <input id="nameuser1" value="@Session["usuario"]"/>
    </div>
    
    <div class="d-flex " id="content-wrapper">
        <div id="sidebar-container" class="fondo ">

            <div class="logo">
               
            </div>

            <div class="menu">
                <div class="d-block text-light p-1 border-0">

                    <button type="button" class="btn btn-success menubtn" onclick="location.href='@Url.Action("Index", "profile")'">
                        Comprar
                    </button>
                </div>

                <div class="d-block text-light p-1 border-0 ">

                    <button type="button" class="btn btn-danger menubtn" onclick="location.href='@Url.Action("venta", "profile")'">
                        Venta
                    </button>

                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" id="cancelaciones" class="btn btn-warning menubtn" onclick="location.href='@Url.Action("cancelaciones", "Profile")'">Cancelación</button>
                </div>

                <div class="d-block text-light p-1 border-0">
                    <button type="button" id="panel" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("Index", "Administracion")'">
                        Panel De Control
                    </button>
                </div>


                <div class="d-block text-light p-1 border-0">
                    <button type="button" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("Index", "Clientes")'">
                        Clientes
                    </button>
                </div>

                <div class="btn-group  d-block text-light p-1 border-0">
                    <button type="button" class="btn btn-dark dropdown-toggle menubtn" id="usuarios" onclick="btndropdown()" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Control De Usuarios
                    </button>
                    <div class="dropdown-menu bg-dark">
                        <button type="button" class="btn btn-dark " onclick="location.href='@Url.Action("Create", "Usuarios")'">Crear Usuario </button>
                        <button type="button" class="btn btn-dark " onclick="location.href='@Url.Action("Index", "Usuarios")'">Buscar Usuario</button>
                        <button type="button" class="btn btn-dark " onclick="location.href='@Url.Action("actualizaruser", "Usuarios")'">Actualizar Sucursal de Usuario</button>
                    </div>
                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" id="cajas" style="display: none" onclick="location.href='@Url.Action("actualizar", "EntradaCaja")'">Dotaciones</button>
                </div>


                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" id="admins" style="display: none" onclick="location.href='@Url.Action("dotaciones", "EntradaCaja")'">Dotaciones</button>
                </div>


                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" id="sucadmin" style="display: none" onclick="location.href='@Url.Action("Index", "sucadmin")'">Dotaciones iniciales</button>
                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn"  onclick="location.href='@Url.Action("datosvr", "SalidaSuc")'">Agrupacion</button>
                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" id="salidacaja" onclick="location.href='@Url.Action("Index", "SalidaSuc")'">Salida de Caja</button>
                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" id="salidaadmin" onclick="location.href='@Url.Action("indexsalidas", "SalidaSuc")'">Salida de Caja</button>
                </div>

                <div class="d-block text-light  border-0">
                    <button type="button" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("cerrararqueo", "Arqueo")'">Arqueo Final</button>
                </div>

                <div class="btn-group  d-block text-light p-1 border-0">
                    <button type="button" class="btn btn-dark dropdown-toggle menubtn" id="tazas" onclick="tazas()" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Tasas
                    </button>
                    <div class="dropdown-menu bg-dark">
                        <button type="button" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("Taxacompras", "Administracion")'">Tasas de Compra</button>
                        <button type="button" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("TazasVentas", "Administracion")'">Tasas de Venta</button>
                        <button type="button" class="btn btn-dark menubtn" onclick="location.href='@Url.Action("Historial", "Administracion")'">Tasas por sucursal</button>
                    </div>
                </div>

                @*<a href="#" class="d-block text-light p-3 border-0">
            <i class="icon ion-md-settings lead mr-2"></i>
            Personalizacion
        </a>*@
            </div>

            </div>

        <div class="w-100">
            <div class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">

                <div class="navbar-header">

                    @Html.ActionLink("Master Exchange", "Index", "profile", new { area = "" }, new { @class = "navbar-brand" })

                </div>


                <div class="collapse navbar-collapse pr-3" id="navbarSupportedContent-4">
                    <ul class="navbar-nav ml-auto">

                        <li class="nav-item active">
                            <a class="nav-link identy" href="#">@Session["usuario"] @Session["apellido"]</a>
                        </li>

                        <li class="nav-item active">
                            <a class="nav-link identy" href="#">@Session["Area"] </a>
                        </li>

                        <li class="nav-item active">
                            <a class="nav-link identy" href="#">@Session["sucursaledelusuario"] - @Session["plazadelusuaio"] </a>
                        </li>

                        <li class="nav-item avatar dropdown">
                            <a class="nav-link dropdown-toggle " onclick="Profile()" id="Profile" data-toggle="dropdown"
                               aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-user-alt"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg-right dropdown-secondary"
                                 aria-labelledby="navbarDropdownMenuLink-55">
                                <a class="dropdown-item" href="#">@Html.ActionLink("Mi Perfil", "Perfil", "usuarios", new { Usuario = Session["cortoName"] }, new { @class = "dropdown-item" })</a>
                                
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <a class="dropdown-item " href="/home/Logout">Cerrar Sesion</a>

                                }

                            </div>
                        </li>

                        

                    </ul>

                </div>

            </div>

            <div id="content" class="bg-grey w-100">
                <div>
                    <div class="row">
                        @RenderBody()
                    </div>


                </div>

            </div>


        </div>
    </div>

    @*<footer>
            <p>&copy; @DateTime.Now.Year - Master Exchance</p>
        </footer>*@

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    @RenderSection("scripts", required: false)

    <script>

        (function () {
            sidebaruser();
        })();

        //validacion de usuarios
        function sidebaruser() {
            var userside = document.getElementById("uservalue").value;
            console.log(userside);

            // comprar tipo de usuario
            switch (userside) {
                //administrativo
                case "1":
                    console.log("administrativo");     
                    document.getElementById("cajas").style.display = "none";
                    document.getElementById("admins").style.display = "";
                   
                    document.getElementById("cancelaciones").style.display = "none";
                    document.getElementById("sucadmin").style.display = "";
                    document.getElementById("salidaadmin").style.display = "";
                    document.getElementById("salidacaja").style.display = "none";

                 
                    break;

                // cajero
                case "2":
                    console.log("cajero");
                    document.getElementById("usuarios").style.display = "none";
                    document.getElementById("tazas").style.display = "none";

                    document.getElementById("cajas").style.display = "";
                    document.getElementById("admins").style.display = "none";

                    document.getElementById("cancelaciones").style.display = "";
                    document.getElementById("sucadmin").style.display = "none";
                    document.getElementById("salidaadmin").style.display = "none";
                    document.getElementById("salidacaja").style.display = "";

                    
                    break;

                // tipo de usuario no detectado
                default:
                    console.log("no detectado");
                    break;
            }
        }


        function btndropdown()
        {
            $('#usuarios').dropdown('toggle')
            
        }

        function arqueo() {
            $('#arqueo').dropdown('toggle')

        }

        function tazas() {
            $('#tazas').dropdown('toggle')

        }


        function Profile() {
            $('#Profile').dropdown('toggle')
            console.log("btn_funciona");
        }

    

    </script>

    <script type="text/javascript">
    $(document).ready(function() {
    $("form").keypress(function(e) {
        if (e.which == 13) {
            return false;
        }
    });
    });
     
</script>

   <script>
       var timeout;
       document.onmousemove = function () {
           clearTimeout(timeout);
          
           timeout = setTimeout(function () {
               location.reload();
           }, 300000);
       }
   </script>


    <script>

       

        function notificaciones() {
            fetch("/notificaciones/notsalidas")
                .then(function (result) {
                    if (result.ok) {
                        return result.json();
                    }
                })
                .then(function (tjson) {

                    let status = "";
                    var nombre = document.getElementById("nameuser1").value;

                    for (let item of tjson) {
                        status += item.Int_estatus
                   
                        if (status == "1") {

                            Push.create("Buen dia " + nombre + "", {
                                tag: 'foo',
                                body: "Tienes una dotación inicial en espera. Por favor, cambie el estatus en Salida de Caja.",
                                icon: '../../Content/img/logo.png',
                                requireInteraction: true,
                                onClick: function () {
                                    window.focus();
                                    this.close();

                                    Push.close('foo');
                                }
                                
                            });


                        }

                    }
                })

        }

        (function () {
            caja();
        })();

        //validacion de usuarios
        function caja() {
            var userside = document.getElementById("uservalue").value;
    
            // comprar tipo de usuario
            switch (userside) {
                //administrativo
                case "1":



                    break;

                // cajero
                case "2":



                    notificaciones();


                    break;

                // tipo de usuario no detectado
                default:
                    console.log("no detectado");
                    break;
            }
        }

        setInterval(function () { notificaciones(); }, 300000);

    </script>


</body>
</html>
